<app-header-nav [items]="[
        { label: 'Dashboard', url: '/dashboard' },
        { label: 'Cricket', url: '/dashboard' },
        { label: 'Events', url:'/events' },
        { label: 'Add Event' }
      ]"></app-header-nav>

<div class="team-container lg:p-6 p-3">

    <div class="events-card">
        <div class="events-header">
            Events
        </div>

        <form [formGroup]="teamForm" class="events-table">

            <div class="events-row events-row-head max-lg:hidden!">
                <div class="events-col">Event Id</div>
                <div class="events-col">Match Id</div>
                <div class="events-col">Type</div>
            </div>


            <div class="events-row">
                 <div class="events-col">
                    <input type="text" formControlName="eventId" placeholder="Event Id" class="events-input" />
                </div>
                <div class="events-col">
                    <input type="text" formControlName="matchId" placeholder="Match Id" class="events-input" />
                </div>

                <div class="events-col">
                    <select formControlName="type" class="events-input">
                        <option value="" disabled>Select type</option>
                        <option value="T20">T20</option>
                        <option value="ODI">ODI</option>
                        <option value="TEST">TEST</option>
                    </select>
                </div>
            </div>
        </form>
    </div>

    <form [formGroup]="teamForm" (ngSubmit)="onSubmit()" class="team-form">
        <div class="teams-wrapper">
            <!-- Team A Card -->
            <div class="team-card team-a">
                <div class="team-header">
                    <h2 class="team-title">Team A</h2>

                </div>

                <div class="team-inputs flex flex-wrap">
                    <div class="md:flex md:flex-row flex-col  items-center  gap-2.5">
                        <div class="input-group flex-auto">
                            <label for="teamAName">Team Name</label>
                            <div class="custom-dropdown team-a-wrapper">
                                <div class="relative">
                                    <input type="text" id="teamAName" formControlName="teamAName"
                                        placeholder="Select or type team name" class="form-input  w-full "
                                        (input)="searchTeamA(teamA.value)"  (focus)="showTeamADropdown = true" #teamA>

                                    <i
                                        class="fa-solid fa-angle-down absolute text-[12px] right-3 top-[50%] translate-y-[-50%] text-[#2BB8EF]"></i>
                                </div>


                                <div class="dropdown-menu"
                                    *ngIf="showTeamADropdown && filterAvailableATeams.length > 0">
                                    <div class="dropdown-item" *ngFor="let team of filterAvailableATeams"
                                        (mousedown)="selectTeamA(team)">
                                        <span>{{team.name}}</span>
                                        <span class="team-code">{{team.code}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="input-group flex-auto">
                            <label for="teamAShortCode">Team Code</label>
                            <input type="text" id="teamAShortCode" formControlName="teamAShortCode" placeholder="IND"
                                class="form-input  w-full">
                        </div>
                        <div class="input-group ">
                            <label for="teamAFlag" class="text-nowrap">Flag</label>
                            <div class="form-input relative max-w-17.5 max-h-15! border-none!">
                                <div class="flag-preview absolute">
                                    <img [src]="teamAFlagPreview || '/india.png'" alt="Team A Flag" class="flag-image">
                                </div>
                                <input type="file" id="teamAFlag" (change)="onTeamAFlagChange($event)" accept="image/*"
                                    class="   w-full  opacity-0">
                            </div>
                        </div>
                    </div>





                </div>


                <div class="players-section">
                    <div class="players-header">
                        <h3>Players ({{ getTeamAPlayers().length }}/11)</h3>
                        <div class="player-controls">
                            <button type="button" (click)="addTeamAPlayer()" [disabled]="getTeamAPlayers().length >= 11"
                                class="btn-control plus-btn">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>

                    <div formArrayName="teamAPlayers" class="players-list">
                        <div *ngFor="let player of getTeamAPlayers().controls; let i = index" [formGroupName]="i"
                            class="player-row">
                            <div class="player-inputs items-center">
                                <div
                                    class="flex border border-[#DAF1FC] rounded-full h-12.5 w-12.5 justify-center items-center">
                                    {{i + 1}}</div>
                                <input type="text" formControlName="name" placeholder="Player name"
                                    class="player-name-input">


                                <select formControlName="type" class="player-type-select appearance-none">
                                    <option value="" disabled selected>Select type</option>
                                    <option value="BATSMAN">BATSMAN</option>
                                    <option value="BOWLER">BOWLER</option>
                                    <option value="ALL_ROUNDER">ALL ROUNDER</option>
                                    <option value="KEEPER">KEEPER</option>
                                </select>

                                <!-- Add minus button for each row -->
                                <button type="button" (click)="removeTeamAPlayerAt(i)"
                                    [disabled]="getTeamAPlayers().length <= 1" class=" minus-btn ml-2 cursor-pointer"
                                    [ngClass]="{'cursor-not-allowed!':getTeamAPlayers().length <= 1}">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Team B Card -->
            <div class="team-card team-b">
                <div class="team-header">
                    <h2 class="team-title">Team B</h2>

                </div>

                <div class="team-inputs flex flex-wrap">
                    <div class="md:flex md:flex-row flex-col  items-center gap-2.5">
                        <div class="input-group flex-auto">
                            <label for="teamBName">Team Name</label>
                            <div class="custom-dropdown team-b-wrapper">
                                <div class="relative">
                                    <input type="text" id="teamBName" formControlName="teamBName"
                                        placeholder="Select or type team name" class="form-input w-full"
                                        (input)="searchTeamB(teamB.value)" (focus)="showTeamBDropdown = true" #teamB>
                                    <i
                                        class="fa-solid fa-angle-down absolute text-[12px] right-3 top-[50%] translate-y-[-50%] text-[#2BB8EF]"></i>
                                </div>


                                <div class="dropdown-menu" *ngIf="showTeamBDropdown">
                                    <div class="dropdown-item" *ngFor="let team of filterAvailableBTeams"
                                        (mousedown)="selectTeamB(team)">
                                        <span>{{team.name}}</span>
                                        <span class="team-code">{{team.code}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="input-group flex-auto">
                            <label for="teamBShortCode">Team Code</label>
                            <input type="text" id="teamBShortCode" formControlName="teamBShortCode" placeholder="AUS"
                                class="form-input   w-full">
                        </div>

                        <div class="input-group ">
                            <label for="teamBFlag" class="text-nowrap">Flag</label>
                            <div class="form-input relative max-w-17.5 max-h-15! border-none!">
                                <div class="flag-preview absolute">
                                    <img [src]="teamBFlagPreview || '/images.png'" alt="Team A Flag" class="flag-image">
                                </div>
                                <input type="file" id="teamBFlag" (change)="onTeamBFlagChange($event)" accept="image/*"
                                    class="   w-full  opacity-0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Team B Players -->
                <!-- Team B Players -->
                <div class="players-section">
                    <div class="players-header">
                        <h3>Players ({{ getTeamBPlayers().length }}/11)</h3>
                        <div class="player-controls">
                            <button type="button" (click)="addTeamBPlayer()" [disabled]="getTeamBPlayers().length >= 11"
                                class="btn-control plus-btn">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>

                    <div formArrayName="teamBPlayers" class="players-list">
                        <div *ngFor="let player of getTeamBPlayers().controls; let i = index" [formGroupName]="i"
                            class="player-row">
                            <div class="player-inputs items-center">

                                <div
                                    class="flex border border-[#DAF1FC] rounded-full h-12.5 w-12.5 justify-center items-center">
                                    {{i + 1}}</div>


                                <input type="text" formControlName="name" placeholder="Player name"
                                    class="player-name-input">

                                <select formControlName="type" class="player-type-select appearance-none">
                                    <option value="" disabled selected>Select type</option>
                                    <option value="BATSMAN">BATSMAN</option>
                                    <option value="BOWLER">BOWLER</option>
                                    <option value="ALL_ROUNDER">ALL ROUNDER</option>
                                    <option value="KEEPER">KEEPER</option>
                                </select>

                                <!-- Add minus button for each row -->
                                <button type="button" (click)="removeTeamBPlayerAt(i)"
                                    [disabled]="getTeamBPlayers().length <= 1" class="minus-btn ml-2 cursor-pointer"
                                    [ngClass]="{'cursor-not-allowed!':getTeamBPlayers().length <= 1}">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
            <button type="submit" [disabled]="!teamForm.valid || isSubmitting" class="btn btn-submit">
                <span *ngIf="!isSubmitting">Submit Teams</span>
                <span *ngIf="isSubmitting">Submitting...</span>
            </button>
        </div>
    </form>


</div>